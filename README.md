# raster-forge

Высокопроизводительный движок нормализации и растеризации документов с генерацией многоуровневой пирамиды разрешений для обработки VLM.

## Обзор

**raster-forge** преобразует разнородные документы (PDF, изображения, смешанные форматы) в унифицированные растрированные выходные данные с многомасштабными представлениями, оптимизированными для Vision Language Model (VLM) inference.

## Возможности

- **Универсальная поддержка входных форматов**: Обработка одно/многостраничных PDF, изображений (PNG, JPG) и смешанных папок с документами
- **Унифицированный выход**: Создание чистых растрированных PDF со встроенными изображениями (без текстовых слоёв)
- **Многоуровневая пирамида разрешений**: Создание каскадных downsampled версий (75/100/150/200/250/300 DPI) для экспериментов с VLM
- **Оптимизация WebP**: Быстрое кодирование с превосходной компрессией для хранения пирамиды
- **Гибкая конфигурация**: YAML-конфигурация с настройкой всех параметров обработки
- **Параллельная обработка**: Конкурентная обработка документов и страниц на основе горутин
- **Неизменность входных данных**: Исходные файлы остаются нетронутыми; все выходные данные в отдельной структуре каталогов

## Быстрый старт

### Установка

```bash
go install github.com/AlexanderKuzikov/raster-forge@latest
```

### Использование

```bash
# Базовое использование с конфигурацией по умолчанию
raster-forge -input ./documents -output ./processed

# С пользовательской конфигурацией
raster-forge -input ./documents -config custom-config.yaml

# Просмотр версии
raster-forge -version
```

### Конфигурация

Создайте файл `config.yaml`:

```yaml
version: "1.0"

rasterization:
  base_dpi: 300
  pyramid_levels: [75, 100, 150, 200, 250, 300]

output:
  format: "webp"
  webp_quality: 85
  pdf_compression: true

processing:
  parallel_pages: true
  max_goroutines: 8
  memory_limit_mb: 4096

downsampling:
  algorithm: "lanczos"
```

## Архитектура

### Структура входных данных

```
input/
├── document1.pdf       # Отдельный PDF (одно- или многостраничный)
├── document2.pdf
├── document3/          # Многофайловый документ
│   ├── page1.pdf
│   ├── page2.pdf
│   └── page3.jpg
└── document4/          # Документ только из изображений
    ├── scan1.png
    └── scan2.png
```

### Структура выходных данных

```
output_YYYYMMDD_HHMMSS/
├── pdfs/
│   ├── document1.pdf   # Растрирован @ 300 DPI
│   ├── document2.pdf
│   ├── document3.pdf
│   └── document4.pdf
└── pyramid/
    ├── document1/
    │   ├── 75dpi/
    │   │   ├── page1.webp
    │   │   └── page2.webp
    │   ├── 100dpi/
    │   │   ├── page1.webp
    │   │   └── page2.webp
    │   ├── 150dpi/
    │   ├── 200dpi/
    │   ├── 250dpi/
    │   └── 300dpi/
    │       ├── page1.webp
    │       └── page2.webp
    ├── document2/
    │   └── ...
    └── document3/
        └── ...
```

### Конвейер обработки

1. **Сканирование входных данных**: Идентификация документов (файлов или папок)
2. **Нормализация**: Объединение многофайловых документов, обработка смешанных форматов
3. **Растеризация**: Преобразование всех страниц в изображения 300 DPI
4. **Сборка PDF**: Создание унифицированного PDF из растрированных страниц
5. **Генерация пирамиды**: Каскадный downsample: 300 → 250 → 200 → 150 → 100 → 75 DPI
6. **Кодирование WebP**: Сохранение уровней пирамиды с оптимизированной компрессией

## Технические детали

### Зависимости

- `gopkg.in/yaml.v3` - парсинг YAML конфигурации
- Планируются: библиотеки для обработки PDF и изображений

### Требования

- Go 1.21+
- Достаточно памяти для обработки высокого разрешения (рекомендуется 8GB+)

## Roadmap

- [ ] Реализация растеризации PDF
- [ ] Интеграция обработки изображений
- [ ] Генерация пирамиды разрешений
- [ ] WebP кодирование
- [ ] Параллельная обработка документов
- [ ] Прогресс-индикация
- [ ] Логирование с уровнями детализации
- [ ] Поддержка дополнительных форматов (TIFF, BMP)
- [ ] Метаданные документов
- [ ] Валидация выходных данных

## Лицензия

Apache License 2.0 - см. [LICENSE](LICENSE)

## Автор

Alexander Kuzikov
